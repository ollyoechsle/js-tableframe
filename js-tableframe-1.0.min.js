window.js=window.js||{},function(){function e(t,n,r,i,s,o){this.id=n,this.name=r,this.data=i,this.model=t,this.valueFn=s||e.DEFAULT_VALUE_FN,this.formatFn=o||e.DEFAULT_FORMAT_FN}e.prototype.id=null,e.prototype.name=null,e.prototype.data=null,e.prototype.valueFn=null,e.prototype.formatFn=null,e.prototype.getAllData=function(){return this.model.allData.map(this.valueFn)},e.prototype.getMax=function(){return Math.max.apply(null,this.getAllData())},e.prototype.isSorted=function(){return this.model.sortField==this.id},e.DEFAULT_VALUE_FN=function(e,t,n){return e},e.DEFAULT_FORMAT_FN=function(e){return e},js.Column=e}(),function(){function e(t,n){this.jContainer=jQuery(t),this.model=n,this.cellRenderers=[e.ADD_COLUMN_CLASS],this.initialise()}e.prototype=Object.create(Subscribable.prototype),e.prototype.jContainer=null,e.prototype.cellRenderers=null,e.prototype.withCellRenderer=function(e){return this.cellRenderers.push(e),this},e.prototype.initialise=function(){this.model.on("allDataChanged",this.draw,this),this.jContainer.delegate("tbody tr","click.table",this.handleRowClick.bind(this)),this.jContainer.delegate("thead th","click.table",this.handleColumnClick.bind(this))},e.prototype.draw=function(){var t=jQuery(e.TABLE),n=this.model.getVisibleRows(),r=this.model.getColumns(),i=t.find("thead tr"),s=t.find("tbody"),o,u,a,f;for(a=0,f=r.length;a<f;a++)o=r[a],u=jQuery("<th></th>").attr("data-column",o.id).html(o.name).appendTo(i),o.isSorted()&&u.attr("data-sort",this.model.sortDirection.id),this.renderCell(u,o,a,this.model);for(a=0,f=n.length;a<f;a++)s.append(this.renderDataRow(n[a],r));this.jContainer.empty().append(t)},e.prototype.handleRowClick=function(e){var t=jQuery(e.currentTarget),n=t.data("id");this.fire("rowClicked",n)},e.prototype.handleColumnClick=function(e){var t=jQuery(e.currentTarget),n=t.data("column");this.model.setSorting(n),this.fire("columnClicked",n)},e.prototype.destroy=function(){this.model.un(null,this),this.jContainer.undelegate(".table")},e.prototype.renderDataRow=function(e,t){var n=jQuery("<tr></tr>").attr("data-id",e.id),r=e.length,i;for(i=0;i<r;i++)this.renderCell(jQuery("<td></td>").html(e[i]).appendTo(n),t[i],i,this.model,e);return n},e.prototype.renderCell=function(e,t,n,r,i){this.cellRenderers.forEach(function(s){s(e,t,n,r,i)})},e.ADD_COLUMN_CLASS=function(e,t,n,r,i){t.data&&t.data.className&&e.addClass(t.data.className)},e.TABLE="<table><thead><tr></tr></tr></thead><tbody></tbody></table>",js.Table=e}(),function(){function e(t){this.sortDirection=e.ASCENDING,this.setAllData(t||{})}function t(e,t,n){return e[n]<t[n]?-1:e[n]>t[n]?1:0}e.prototype=Object.create(Subscribable.prototype),e.prototype.columns=null,e.prototype.allData=null,e.prototype.pageSize=null,e.prototype.pageNumber=null,e.prototype.sortField=null,e.prototype.sortDirection=null,e.prototype.createColumnInstance=function(e){return new js.Column(this,e.id,e.name,e.data,e.valueFn,e.formatFn)},e.prototype.setAllData=function(e){this.columns=(e.columns||[]).map(this.createColumnInstance.bind(this)),this.allData=e.data||[],this.pageSize=e.pageSize||10,this.pageNumber=e.pageNumber||0,this.fire("allDataChanged")},e.prototype.setPage=function(e){this.pageNumber=e||0,this.fire("allDataChanged")},e.prototype.setSorting=function(t,n){return console.log("setSorting",arguments),this.sortDirection=n||t==this.sortField?this.sortDirection.toggle():e.ASCENDING,this.sortField=t,this.fire("allDataChanged"),this},e.prototype.setFormatter=function(e,t){var n=this.getColumn(e);return n&&(n.formatFn=t),this},e.prototype.getColumn=function(e){return this.columns.filter(function(t,n,r){return t._index=n,t.id==e})[0]},e.prototype.getColumns=function(){return this.columns},e.prototype.getVisibleRows=function(){var e=this.allData.map(this.transformToValues.bind(this)),t=this.sort(e),n=t.filter(this.inPage.bind(this)),r=n.map(this.transformToFormatted.bind(this));return r},e.prototype.sort=function(e){for(var t=0,n=this.columns.length;t<n;t++){var r=this.columns[t];if(r.isSorted())return e.sort(this.sortDirection.sorter(t))}return e},e.prototype.transformToValues=function(e){var t=this.columns.map(function(t,n){return t.valueFn(e[t.id],e,t)});return t.id=e.id,t},e.prototype.transformToFormatted=function(e){var t=this.columns.map(function(t,n){return t.formatFn(e[n],e,t)});return t.id=e.id,t},e.prototype.inPage=function(e,t,n){var r=this.pageNumber*this.pageSize;return t>=r&&t<r+this.pageSize},e.NO_FORMAT=function(e){return e},e.ASCENDING={id:"ascending",sorter:function(e){return function(n,r){return t(n,r,e)}},toggle:function(){return e.DESCENDING}},e.DESCENDING={id:"descending",sorter:function(e){return function(n,r){return-1*t(n,r,e)}},toggle:function(){return e.ASCENDING}},js.TableModel=e}();