window.js=window.js||{},function(){function e(t,n){this.jContainer=jQuery(t),this.model=n,this.cellRenderers=[e.ADD_COLUMN_CLASS],this.initialise()}e.prototype=Object.create(Subscribable.prototype),e.prototype.jContainer=null,e.prototype.cellRenderers=null,e.prototype.withCellRenderer=function(e){return this.cellRenderers.push(e),this},e.prototype.initialise=function(){this.model.on("allDataChanged",this.draw,this),this.jContainer.delegate("tbody tr","click.table",this.handleRowClick.bind(this))},e.prototype.draw=function(){var t=jQuery(e.TABLE),n=this.model.getVisibleRows(),r=this.model.getColumns(),i=t.find("thead tr"),s=t.find("tbody"),o,u,a;for(u=0,a=r.length;u<a;u++)o=r[u],this.renderCell(jQuery("<th></th>").attr("data-column",o.id).html(o.name).appendTo(i),o,u,this.model);for(u=0,a=n.length;u<a;u++)s.append(this.renderDataRow(n[u],r));this.jContainer.empty().append(t)},e.prototype.handleRowClick=function(e){var t=jQuery(e.currentTarget),n=t.data("id");this.fire("rowClicked",n)},e.prototype.destroy=function(){this.model.un(null,this),this.jContainer.undelegate(".table")},e.prototype.renderDataRow=function(e,t){var n=jQuery("<tr></tr>").attr("data-id",e.id),r=e.length,i;for(i=0;i<r;i++)this.renderCell(jQuery("<td></td>").html(e[i]).appendTo(n),t[i],i,this.model,e);return n},e.prototype.renderCell=function(e,t,n,r,i){this.cellRenderers.forEach(function(s){s(e,t,n,r,i)})},e.ADD_COLUMN_CLASS=function(e,t,n,r,i){e.addClass(t.className)},e.TABLE="<table><thead><tr></tr></tr></thead><tbody></tbody></table>",js.Table=e}(),function(){function e(e){this.setAllData(e||{})}e.prototype=Object.create(Subscribable.prototype),e.prototype.columns=null,e.prototype.allData=null,e.prototype.pageSize=null,e.prototype.pageNumber=null,e.prototype.setAllData=function(e){this.columns=e.columns||[],this.allData=e.data||[],this.pageSize=e.pageSize||10,this.pageNumber=e.pageNumber||0,this.fire("allDataChanged")},e.prototype.setPage=function(e){this.pageNumber=e||0,this.fire("allDataChanged")},e.prototype.setFormatter=function(e,t){var n=this.getColumn(e);return n&&(n.formatter=t),this},e.prototype.getColumn=function(e){return this.columns.filter(function(t){return t.id==e})[0]},e.prototype.getColumns=function(){return this.columns},e.prototype.getVisibleRows=function(){return this.allData.filter(this.inPage.bind(this)).map(this.transformRow.bind(this))},e.prototype.transformRow=function(t){var n=[];return this.columns.forEach(function(r){var i=r.formatter||e.NO_FORMAT,s=i(t[r.id],t);s.className=r.className,n.push(s)}),n.id=t.id,n},e.prototype.inPage=function(e,t,n){var r=this.pageNumber*this.pageSize;return t>=r&&t<r+this.pageSize},e.NO_FORMAT=function(e){return e},js.TableModel=e}();