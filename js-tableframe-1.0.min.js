window.js=window.js||{},function(){function e(t,n){this.jContainer=jQuery(t),this.model=n,this.cellRenderers=[e.ADD_COLUMN_CLASS],this.initialise()}e.prototype=Object.create(Subscribable.prototype),e.prototype.jContainer=null,e.prototype.cellRenderers=null,e.prototype.withCellRenderer=function(e){return this.cellRenderers.push(e),this},e.prototype.initialise=function(){this.model.on("allDataChanged",this.draw,this),this.jContainer.delegate("tbody tr","click.table",this.handleRowClick.bind(this)),this.jContainer.delegate("thead th","click.table",this.handleColumnClick.bind(this))},e.prototype.draw=function(){var t=jQuery(e.TABLE),n=this.model.getVisibleRows(),r=this.model.getColumns(),i=t.find("thead tr"),s=t.find("tbody"),o,u,a,f;for(a=0,f=r.length;a<f;a++)o=r[a],u=jQuery("<th></th>").attr("data-column",o.id).html(o.name).appendTo(i),o.sort&&(u.attr("data-sort",o.sort.direction),u.attr("data-max",o.sort.max)),this.renderCell(u,o,a,this.model);for(a=0,f=n.length;a<f;a++)s.append(this.renderDataRow(n[a],r));this.jContainer.empty().append(t)},e.prototype.handleRowClick=function(e){var t=jQuery(e.currentTarget),n=t.data("id");this.fire("rowClicked",n)},e.prototype.handleColumnClick=function(e){var t=jQuery(e.currentTarget),n=t.data("column");this.model.setSorting(n),this.fire("columnClicked",n)},e.prototype.destroy=function(){this.model.un(null,this),this.jContainer.undelegate(".table")},e.prototype.renderDataRow=function(e,t){var n=jQuery("<tr></tr>").attr("data-id",e.id),r=e.length,i;for(i=0;i<r;i++)this.renderCell(jQuery("<td></td>").html(e[i]).appendTo(n),t[i],i,this.model,e);return n},e.prototype.renderCell=function(e,t,n,r,i){this.cellRenderers.forEach(function(s){s(e,t,n,r,i)})},e.ADD_COLUMN_CLASS=function(e,t,n,r,i){e.addClass(t.className)},e.TABLE="<table><thead><tr></tr></tr></thead><tbody></tbody></table>",js.Table=e}(),function(){function e(t){this.sortDirection=e.ASCENDING,this.setAllData(t||{})}function t(e,t,n){return e[n]<t[n]?-1:e[n]>t[n]?1:0}e.prototype=Object.create(Subscribable.prototype),e.prototype.columns=null,e.prototype.allData=null,e.prototype.pageSize=null,e.prototype.pageNumber=null,e.prototype.sortField=null,e.prototype.sortDirection=null,e.prototype.setAllData=function(e){this.columns=e.columns||[],this.allData=e.data||[],this.pageSize=e.pageSize||10,this.pageNumber=e.pageNumber||0,this.fire("allDataChanged")},e.prototype.setPage=function(e){this.pageNumber=e||0,this.fire("allDataChanged")},e.prototype.setSorting=function(t,n){return console.log("setSorting",arguments),this.sortDirection=n||t==this.sortField?this.sortDirection.opposite():e.ASCENDING,this.sortField=t,this.fire("allDataChanged"),this},e.prototype.setFormatter=function(e,t){var n=this.getColumn(e);return n&&(n.formatter=t),this},e.prototype.getColumn=function(e){return this.columns.filter(function(t,n,r){return t._index=n,t.id==e})[0]},e.prototype.getColumns=function(){return this.columns},e.prototype.getVisibleRows=function(){var e=this.allData.map(this.transformRow.bind(this));return this.columns.forEach(function(t,n){if(t.id==this.sortField){e=e.sort(this.sortDirection.sorter(n));var r=0;e.forEach(function(t){var i=t[n];!isNaN(i)&&i>r&&(r=i)}),t.sort={direction:this.sortDirection.id,max:r}}else t.sort=null}.bind(this)),e.filter(this.inPage.bind(this))},e.prototype.transformRow=function(t){var n=this.columns.map(function(n){var r=n.formatter||e.NO_FORMAT;return r(t[n.id],t)});return n.id=t.id,n},e.prototype.inPage=function(e,t,n){var r=this.pageNumber*this.pageSize;return t>=r&&t<r+this.pageSize},e.NO_FORMAT=function(e){return e},e.ASCENDING={id:"ascending",sorter:function(e){return function(n,r){return t(n,r,e)}},opposite:function(){return e.DESCENDING}},e.DESCENDING={id:"descending",sorter:function(e){return function(n,r){return-1*t(n,r,e)}},opposite:function(){return e.ASCENDING}},js.TableModel=e}();